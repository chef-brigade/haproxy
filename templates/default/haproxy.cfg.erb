global
  user <%= @user %>
  group <%= @global['group'] %>
  <% if @global['pid_file'] -%>pidfile <% @global['pid_file'] %><% end %>
  log <%= @global['log'] %>
  <% if @global['log_tag'] -%>log-tag <%= @global['log_tag'] %><% end -%>
  <% if @global['chroot'] -%>chroot <%= @global['chroot'] %><% end -%>
  <% if @global['daemon'].eql? 'true' -%>daemon<% end -%>
  <%= @global['debug_option'] %>
  stats socket <%= @global['stats_socket'] %>
  stats timeout <%= @global['stats_timeout'] %>
  maxconn <%= @global['maxconn'] %>
  retries <%= @global['retries'] %>
  client-timeout <%= @global['client_timeout'] %>
  server-timeout <%= @global['server_timeout'] %>
  connect-timeout <%= @global['connect_timeout'] %>
  mode <%= @global['mode'] %>
  <% if @global['pidfile'] -%>pidfile <%= @global['pidfile'] %><% end -%>
<% if !@global['tuning'].nil? %>
  <% @global['tuning'].each do |option,value| -%>
  tune.<%= option %> <%= value %>
  <% end -%>
<% end -%>
<% if !@global['extra_options'].nil? -%>
  <% @global['extra_options'].each do |option,value| -%>
  <%= option %> <%= value %>
  <% end -%>
<% end -%>

defaults
  mode <%= @defaults['mode'] %>
  <% unless @defaults['maxconn'] == '' -%>maxconn <%= @defaults['maxconn'] %><% end -%>
  <% unless @defaults['retries'] == '0' -%>retries <%= @defaults['retries'] %><% end -%>
  <% unless @defaults['balance'] == '' -%>balance <%= @defaults['balance'] %><% end -%>
  log <%= @defaults['log'] %>
  retries <%= @defaults['retries'] %>
  <% @defaults['timeouts'].each do | value, time | -%>
  timeout <%= value %> <%= time %>
  <% end -%>
  <% unless @defaults['extra_options'].nil? %>
  <% @defaults['extra_options'].each do | option, value | -%>
  <%= option %> <%= value %>
  <% end -%>
  <% end -%>


<% @frontend.each do |frontend, value | %>
frontend <%= frontend %>
  bind <%= value['bind'] %>
  default_backend <%= value['default_backend'] %>
  maxconn <%= value['maxconn'] %>
  <% if !value['use_backend'].nil? %>
  <% value['use_backend'].each do | backend |%>
  <% backend.each do | backend | %>
  use_backend <%= backend %>
  <% end -%>
  <% end -%>
  <% end -%>
  <% if !value['option'].nil? %>
  <% value['option'].each do | option |%>
  <% option.each do | option | %>
  option <%= option %>
  <% end -%>
  <% end -%>
  <% end -%>

  <% if !value['extra_options'].nil? %>
  <% value['extra_options'].each do | key, value |%>
  <%= key %> <%= value %>
  <% end -%>
  <% end -%>

<% end -%>

<% @backend.each do | key, listeners | %>
backend <%= key %>
  <% listeners['server'].each do | s |%>
    <% s.each  do |server|%>
  server <%= server %>
    <% end -%>
  <% end -%>
  <% if !listeners['extra_options'].nil? %>
  <% listeners['extra_options'].each do | key, value |%>
  <%= key %><%= value %>
  <% end -%>
  <% end -%>
<% end -%>
